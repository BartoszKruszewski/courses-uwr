# Wykład 11 - Wzorce architektury aplikacji 3

## Repository

Repository stanowi dodatkową warstwę abstrakcji nad warstwą dostępu do danych.
Odpowiada za dostęp do jednej kategorii danych (np. jednej tabeli w bazie danych).

## Rodzaje Repository

### Generic Repository
- Jeden wspólny interfejs dla wszystkich encji.
- Wspiera uniwersalne interfejsy zapytań (np. LINQ, JPA).
- Umożliwia prostsze zarządzanie repozytoriami.

### Concrete Repository
- Osobny interfejs repozytorium dla każdej klasy modelu.
- Umożliwia tworzenie metod specyficznych dla danego typu (np. `FindAllUsersForStartingLetter`).
- Trudniejsze w utrzymaniu i rozwijaniu – konieczność dodawania metod przy ewolucji projektu.

## Unit of Work (UoW)

Jedna warstwa agregująca wiele repozytoriów. Odpowiada za:
- Udostępnianie dostępu do wszystkich repozytoriów z jednego miejsca.
- Współdzielenie kontekstu dostępu do danych.
- Zarządzanie transakcjami (opcjonalnie).

### Korzyści
- Upraszcza korzystanie z repozytoriów (jedna instancja zamiast wielu).
- Zapewnia spójność (wspólny kontekst dostępu do danych).
- Możliwość rozbudowy o zarządzanie transakcjami i metadanymi.

**Uwaga:** Repository powinien być implementowany wraz z Unit of Work. 
Oddzielne repozytoria bez UoW prowadzą do problemów z integracją w wyższych warstwach aplikacji.

## Struktura projektu

### Warstwa abstrakcji
- Interfejsy modeli: `IUser`, `IAddress`, `IParent`, `IChild`
- Interfejs repozytorium: `IGenericRepository<T>` lub zestaw konkretnych interfejsów
- Interfejs UoW: `IUnitOfWork`
- Fabryka `UnitOfWorkFactory` – zapewnia instancje UoW

### Kod kliencki
- Odwołuje się tylko do abstrakcji i fabryki.
- Nie zna implementacji repozytoriów ani modeli.

### Warstwa implementacji
- Różne zestawy modeli, repozytoriów i UoW dla każdej technologii (np. `EFUnitOfWork`, `LinqUnitOfWork`)
- Dopasowanie wygenerowanych klas do interfejsów (np. `Child : IChild`)
- Konfiguracja zależności w `Composition Root`

### Composition Root
- Ustawia dostawcę fabryki `UnitOfWorkFactory`
- Może korzystać z kontenera IoC
